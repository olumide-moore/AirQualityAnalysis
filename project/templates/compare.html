{% extends 'base.html' %}

{% load static %}

{% block title %}Compare sensors{% endblock %}

{% block content %}


  {% include 'inputs.html' %}
  <div class="grid lg:grid-cols-4 sm:grid-cols-2 gap-10 bg-white p-6 rounded-sm shadow-xs"> 
   
    <!-- Correlation cards -->
    <div class="col-span-2 flex flex-col justify-between space-y-10 ">
      <div>
        <h2 class="text-xl md:text-xl lg:text-xl font-bold text-gray-700 mb-10">
          Pearson Correlation Coefficient
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-3 lg:gap-48 lg:grid-cols-3 lg:pt-20 gap-8 items-stretch">
          
          <!-- NO2 correlation -->
          <div class="text-black rounded-2xl shadow-lg overflow-hidden flex flex-col justify-between p-4 w-44 h-36 bg-gray-300">
            <div class="flex justify-end items-center mt-2 mr-2">
              <img src="{% static 'icons/no2.svg' %}" alt="NO₂" class="w-10 h-10">
            </div>
            <div class="font-bold text-xl">
              <span id="no2correlation" class="text-xl"></span>
            </div>
            <div class="text-md">NO<sub>2</sub> correlation</div>
          </div>

          <!-- PM2.5 correlation -->
          <div  class="text-black rounded-2xl shadow-lg overflow-hidden flex flex-col justify-between p-4 w-44 h-36 bg-gray-300">
            <div class="flex justify-end items-center">
              <img src="{% static 'icons/pm2_5.svg' %}" alt="PM2_5" class="w-12 h-12">
            </div>
            <div class="font-bold text-xl">
              <span id="pm2_5correlation" class="text-xl"></span>
            </div>
            <div class="text-md">PM<sub>2.5</sub> correlation</div>
          </div>

          <!-- PM10 correlation -->
          <div class="text-black rounded-2xl shadow-lg overflow-hidden flex flex-col justify-between p-4 w-44 h-36 bg-gray-300">
            <div class="flex justify-end items-center mt-1 mr-2">
              <img src="{% static 'icons/pm10.svg' %}" alt="PM₁₀" class="w-10 h-10">
            </div>
            <div class="font-bold text-xl">
              <span id="pm10correlation" class="text-xl"></span>
            </div>
            <div class="text-md">PM<sub>10</sub> correlation</div>
          </div>
        </div>
      </div>
      <div class="flex items-center space-x-2">
        <label>
          Average interval for correlation:
        </label>
        <div class="flex items-center space-x-1">
          <select id="corravginterval" class="border border-gray-300 rounded-md p-1" onchange="updateCorrelation()">
            <option value="1">1 minute</option>
            <option value="5">5 minutes</option>
            <option value="10">10 minutes</option>
            <option value="15">15 minutes</option>
            <option value="30">30 minutes</option>
            <option value="60">1 hour</option>
            <option value="480">8 hours</option>
          </select>
          <span data-tooltip-target="corravgintervalTooltip" >
            <img src="{% static 'icons/help.svg' %}" alt="help" class="w-5 h-5">
          </span>
        </div>

      </div>
      <div id="corravgintervalTooltip" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-xs font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700">
        Time interval for averaging data before calculating correlation. Shorter intervals may reveal fine-scale variations, while longer intervals can smooth out short-term fluctuations.
          <div class="tooltip-arrow" data-popper-arrow></div>
      </div>
      <div>
        <a href="{%url 'correlationguide' %}" class="text-indigo-600 hover:text-indigo-900 transition duration-300 ease-in-out">
          What is Pearson Correlation?
        </a>
      </div>

    </div>

     <!--Sensor Info Table-->
     <div class="col-span-2 p-2 w-2/3 lg:ml-auto shadow-sm">
      <table class="w-full border-collapse border-[1px] text-sm">
        <tbody>
          <!--INFO Header-->
          <tr>
            <td class="px-4 py-2 font-semibold"></td>
            <td class="px-4 py-2 font-semibold">Sensor 1</td>
            <td class="px-4 py-2 font-semibold">Sensor 2</td>
          </tr>
          <tr class="bg-gray-100">
            <td class="px-4 py-2 font-semibold">Sensor Type</td>
            <td id="table-sensorType1" class="sensorType px-4 py-2"></td>
            <td id="table-sensorType2" class="sensorType px-4 py-2"></td>
          </tr>
          <tr>
            <td class="px-4 py-2 font-semibold">ID</td>
            <td id="table-sensorId1" class="px-4 py-2"></td>
            <td id="table-sensorId2" class="px-4 py-2"></td>
          </tr>
          <tr class="bg-gray-100">
            <td class="px-4 py-2 font-semibold">Last updated</td>
            <td id="table-lastUpdated1" class="px-4 py-2"></td>
            <td id="table-lastUpdated2" class="px-4 py-2"></td>
          </tr>
        </tbody>
      </table>
    </div>

  </div>



  <div class="flex flex-col p-5 my-10">
    <div>
      <!-- Plot types tabs -->
      <ul class="flex">
        <li class="mr-1">
          <button class="py-2 px-4 inline-block border-b-2 border-transparent chartTypeTabs" id="rawdataTab" onclick="switchChartTypeTab(event, 'RawDtaMultiLineCharts')"> Raw Data
          </button>
        </li>
        <li class="mr-1">
          <button class="py-2 px-4 inline-block border-b-2 border-transparent chartTypeTabs" id="scatterTab" onclick="switchChartTypeTab(event, 'ScatterPlots')"> Scatter Plots
          </button>
        </li>
        <li class="mr-1">
          <button class="py-2 px-4 inline-block border-b-2 border-transparent chartTypeTabs" id="hourlyTab" onclick="switchChartTypeTab(event, 'HourlyBoxPlots')"> Hourly Boxplots
          </button>
        </li>
        <span data-tooltip-target="chartTooltip" >
          <img src="{% static 'icons/help.svg' %}" alt="help" class="w-6 h-6">
        </span>
        <div id="chartTooltip" role="tooltip" class="absolute z-10 invisible inline-block px-3 py-2 text-xs font-medium text-white transition-opacity duration-300 bg-gray-900 rounded-lg shadow-sm opacity-0 tooltip dark:bg-gray-700">
          <p class="text-xs">Hover over the charts to see the values at each point. Click the legends to toggle data visibility.</p>
          <div class="tooltip-arrow" data-popper-arrow></div>
        </div>
      </ul>
    </div>

    <div class="bg-white">
      <!-- Raw Data Line Charts -->
      <div id="rawdataMultiLineCharts">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-5">
          <div class="p-4 border-gray-300 border-[1px] my-2 rounded-lg bg-white ml-2">
            <h2 class="text-sm font-medium leading-6 text-gray-900 mb-4">NO<sub>2</sub> Data</h2>
            <div><canvas id="no2LineChart"></canvas></div>
          </div>
          <div class="p-4 border-gray-300 border-[1px] my-2 rounded-lg bg-white">
            <h2 class="text-sm font-medium leading-6 text-gray-900 mb-4">PM<sub>2.5</sub> Data</h2>
            <div><canvas id="pm2_5LineChart"></canvas></div>
          </div>
          <div class="p-4 border-gray-300 border-[1px] my-2 rounded-lg bg-white mr-2">
            <h2 class="text-sm font-medium leading-6 text-gray-900 mb-4">PM<sub>10</sub> Data</h2>
            <div><canvas id="pm10LineChart"></canvas></div>
          </div>
        </div>
      </div>

      <!-- Scatter plot-->
      <div id="scatterPlots">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-5">
          <div class="p-4 border-gray-300 border-[1px] my-2 rounded-lg bg-white ml-2">
            <h2 class="text-sm font-medium leading-6 text-gray-900 mb-4">NO<sub>2</sub>(µg/m³)</h2>
            <div><canvas id="no2ScatterPlot"></canvas></div>
          </div>
          <div class="p-4 border-gray-300 border-[1px] my-2 rounded-lg bg-white">
            <h2 class="text-sm font-medium leading-6 text-gray-900 mb-4">PM<sub>2.5</sub>(µg/m³)</h2>
            <div><canvas id="pm2_5ScatterPlot"></canvas></div>
          </div>
          <div class="p-4 border-gray-300 border-[1px] my-2 rounded-lg bg-white mr-2">
            <h2 class="text-sm font-medium leading-6 text-gray-900 mb-4">PM<sub>10</sub>(µg/m³)</h2>
            <div><canvas id="pm10ScatterPlot"></canvas></div>
          </div>
        </div>
      </div>
      
      <!-- Box plot-->
      <div id="hourlyBoxPlots">
        <div class="flex flex-col space-y-4 mt-5">
          <div class="p-4 border-gray-300 border-[1px] my-2 rounded-lg bg-white mx-2">
            <h2 class="text-sm font-medium leading-6 text-gray-900 mb-4">NO<sub>2</sub> Hourly Comparison</h2>
            <div><canvas id="no2BoxPlot"></canvas></div>
          </div>
          <div class="p-4 border-gray-300 border-[1px] my-2 rounded-lg bg-white mx-2">
            <h2 class="text-sm font-medium leading-6 text-gray-900 mb-4">PM<sub>2.5</sub> Hourly Comparison</h2>
            <div><canvas id="pm2_5BoxPlot"></canvas></div>
          </div>
          <div class="p-4 border-gray-300 border-[1px] my-2 rounded-lg bg-white mx-2">
            <h2 class="text-sm font-medium leading-6 text-gray-900 mb-4">PM<sub>10</sub> Hourly Comparison</h2>
            <div><canvas id="pm10BoxPlot"></canvas></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  
{% endblock %}

{% block scripts %}
<script type="text/javascript" src="{% static 'js/compare.js' %}"></script>
<script type="text/javascript">
  const init_sensorType1="{{ sensorType1|escapejs }}";
  const init_sensorId1="{{ sensorId1|escapejs }}";
  const init_date="{{ date|escapejs }}";
</script>

{% endblock %}
